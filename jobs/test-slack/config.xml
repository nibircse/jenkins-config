<?xml version='1.0' encoding='UTF-8'?>
<flow-definition plugin="workflow-job@2.8">
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <org.jenkinsci.plugins.workflow.job.properties.PipelineTriggersJobProperty>
      <triggers/>
    </org.jenkinsci.plugins.workflow.job.properties.PipelineTriggersJobProperty>
  </properties>
  <definition class="org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition" plugin="workflow-cps@2.21">
    <script>//Job DSL script
import jenkins.model.Jenkins

@NonCPS
def getSlackToken(){
	String slackCredentialsId = &apos;slack-test-bots&apos;
	def jenkins_creds = Jenkins.instance.getExtensionList(&apos;com.cloudbees.plugins.credentials.SystemCredentialsProvider&apos;)[0]

	String found_slack_token = jenkins_creds.getStore().getDomains().findResult { domain -&gt;
	  jenkins_creds.getCredentials(domain).findResult { credential -&gt;
	    if(slackCredentialsId.equals(credential.id)) {
	      credential.getSecret()
	    }
	  }
	}
	return found_slack_token
}

def slackToken = getSlackToken()
slackSend channel: &apos;#test-bots&apos;, color: &apos;good&apos;, message: &apos;message from jenkinsfile&apos;, teamDomain: &apos;subutai-io&apos;, token: &apos;${slackToken}&apos;</script>
    <sandbox>true</sandbox>
  </definition>
  <triggers/>
</flow-definition>